<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>货量走势查询</title>

    <link rel="stylesheet" type="text/css" href="../../dm/common.css">
    <link href="../../tools/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <script src="../../tools/jquery/jquery-2.1.3.min.js"></script>
    <script src="../../tools/bootstrap/js/bootstrap.min.js"></script>
    <script src="../../tools/echarts-2.0.4/echarts-plain-map.js"></script>

    <script src="../../framework/core.js"></script>
    <script src="../../framework/ajax.js"></script>
    <script src="../../dm/common.js"></script>

    <script type="text/javascript">
    window.onload = function() {
        var originData = window.parent.globalValiable.data,
            queryParams = window.parent.globalValiable.queryParams,
            trend = document.getElementById('TrendCanvas'),
            summary = document.getElementById('Summary'),
            title;
        trend.style.height = (screen.height - 195) + 'px';
        summary.style.height = (screen.height - 195) + 'px';

        $("#Tab1").click();
        if(queryParams.param4 == '-1'){
            titile = '全网';
        }
        else if(queryParams.param5 == '-1'){
            titile = queryParams.param4;
        }
        else{
            titile = queryParams.param5;
        }
        Trend(originData,queryParams.param3,titile);
    }

    function Trend(originData,type,title){
        var  data = [],data2 = [],DayList = [],series = [],
            min = 99999999,max = 0,mid,rotate,
            avg1 = 0,avg2 = 0,max1 = {d:'',n:0},max2 = {d:'',n:0},
            min1 = {d:'',n:99999999},min2 = {d:'',n:99999999},
            summary = document.getElementById('Summary');

        rotate = type == 'd'?-45:0;

        for(var i = 0; i < originData.length; i++){
            var inday = originData[i]["day"],
                fd = originData[i]["frist_day"],
                w = originData[i]["weight_in"],
                d = originData[i]["weight_disp"];

            if(type == 'm'){
                inday += '月(' + fd.substr(5,5) + '开始)';
            }
            else if(type == 'w'){
                inday += '周(' + fd.substr(5,5) + '开始)';
            }
            else{
                inday = inday.substr(5,5);
            }
            DayList.push(inday);
            data.push(w);
            data2.push(d);

            max = w > max?w:max;
            max = d > max?d:max;
            min = w < min?w:min;
            min = d < min?d:min;

            max1.d = w > max1.n?inday:max1.d;
            max1.n = w > max1.n?w:max1.n;
            min1.d = w < min1.n?inday:min1.d;
            min1.n = w < min1.n?w:min1.n;
            max2.d = d > max2.n?inday:max2.d;
            max2.n = d > max2.n?d:max2.n;
            min2.d = d < min2.n?inday:min2.d;
            min2.n = d < min2.n?d:min2.n;
            avg1 += w/originData.length;
            avg2 += d/originData.length;
        }

        mid = max/2 + min/2;
        if(mid>1000){
            max = Math.ceil(max/1000)*1000;
            min = Math.floor(min/1000)*1000;
        }
        else if(mid>100){
            max = Math.ceil(max/100)*100;
            min = Math.floor(min/100)*100;
        }
        else if(mid>10){
            max = Math.ceil(max/10)*10;
            min = Math.floor(min/10)*10;
        }
        else{
            max = Math.ceil(max/10)*10;
            min = 0;
        }

        summary.innerHTML += '<dt class="myh">范围：' + title +'</dt><dt class="myh myh2">入网货量</dt><dd class="myl">最大：' + max1.n + '(' + max1.d + ')</dd><dd class="myl">最小：' + min1.n + '(' + min1.d + ')</dd><dd class="myl">平均  ' + avg1.toFixed(1) + '</dd><dt class="myh myh2">派送货量</dt><dd class="myl">最大：' + max2.n + '(' + max2.d + ')</dd><dd class="myl">最小：' + min2.n + '(' + min2.d + ')</dd><dd class="myl">平均  ' + avg2.toFixed(1) + '</dd>'

        series.push({
            name:'入网货量',
            type:'line',
            data:data,
            symbol:'none',
            smooth:true,
            itemStyle: {
                normal: {
                    lineStyle: {   
                        color:'#ec4646',
                        width: 3
                    }
                }
            }
        });

        series.push({
            name:'派送货量',
            type:'line',
            data:data2,
            symbol:'none',
            smooth:true,
            itemStyle: {
                normal: {
                    lineStyle: {   
                        color:'#6AA69B',
                        width: 3
                    }
                }
            }
        });

        var myChart = echarts.init(document.getElementById('TrendCanvas'));
//////////////////////////////////////////////OPTION
var option = {
    tooltip : {
        trigger: 'axis',
        axisPointer:{type : 'none'},
        textStyle:{fontSize:'16',color:'#fff',fontFamily:'Microsoft YaHei'},
        formatter:function(d){
            var l = d.length,
                result = d[0][1];

            for(var i = 0;i < d.length;i++){
                if(d[i][2] != '-'){
                    result += '<br/>' + d[i][0] + ':' + d[i][2] + '吨';
                }
                else{
                    result += '<br/>' + d[i][0] + ':' + '-';
                }
            }

            return result;
        }
    },
    calculable : true,
    xAxis : [
        {
            type : 'category',
            axisLine:{lineStyle:{color:'#999'}},
            boundaryGap : false,
            axisLabel:{
                rotate:rotate,
                interval:0,
                textStyle:{color:'#999',fontSize:'16'}
            },
            data : DayList
        }
    ],
    yAxis : [
        {
            name:'吨',
            nameTextStyle:{
                fontSize:'18',
                fontFamily:'Microsoft YaHei'
            },
            type : 'value',
            axisLine:{lineStyle:{color:'#999'}},
            axisLabel:{textStyle:{color:'#999',fontSize:'16'}},
            min:min,
            max:max
        }
    ],
    series : series
};            
        myChart.setOption(option);
    }

    </script>

    <style type="text/css">
        .myh {
            font-family:Microsoft YaHei;
            font-size:20px;
            color:#ec4646;
        }
        .myh2 {
            text-indent:60px;
            margin-top: 50px;
        }
        .myl {
            font-family:Microsoft YaHei;
            font-size:16px;
            text-indent:120px;
            color:#ec4646;
            margin-top: 20px;
        }
        dt {
            font-family:Microsoft YaHei;
            font-size:20px;
            text-indent:30px;
        }
        dd {
            font-family:Microsoft YaHei;
            font-size:16px;
            text-indent:60px;
        }
        li {font-family:Microsoft YaHei;color:#ec4646}
        th {
            color:#999;
            font-family:Microsoft YaHei;
            font-style:normal;
        }
        td{font-family:Microsoft YaHei;}
        span {width:16px;height:16px;}
        .modal-title{font-family:Microsoft YaHei;color:#ec4646;}
        .panel-heading,.btn-primary {font-family:Microsoft YaHei;}
        .table-hover{margin-top: 15px;}
        .copybtn {
            font-family:Microsoft YaHei;
            width:140px;
            margin-top: 3px;
        }
        .Tab {font-family:Microsoft YaHei;}
        .ul{
            background-color:#2e2e2e;
            font-family:Microsoft YaHei;
            text-align: center;
            color:#ec4646;
            width: 140px;
            margin-top: 5px;
            margin-left: 15px;
            border-radius: 4px;
            border: 1px solid #ddd;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.067);
        }
/*//////////////////////////////////////Bootstrap Style*/
        ul.nav-tabs{
            background: #2e2e2e;
            border: #2e2e2e;
        }
        ul.nav-tabs li ul{
            background: #2e2e2e;
        }
        ul.nav-tabs li a{
            color:#ec4646;
            background: #2e2e2e;
            margin: 0;
            padding: 8px 16px;
            border-radius: 0;
            border: 1px solid #2e2e2e;
        }
        ul.nav-tabs li.active a{
            color:#fff;
            background: #ec4646;
            margin: 0;
            padding: 8px 16px;
            border-radius: 0;
            border: 1px solid #ec4646;
        }
        ul.nav-tabs li.active a:hover{
            color: #fff;
            background: #ec4646;
            border: 1px solid #ec4646;
        }
    </style>
</head>

<body>
<ul id="myTab" class="nav nav-tabs">
    <li class="Tab"><a id='Tab1' href="#TabCanvas" data-toggle="tab">走势图</a></li>
    <li class="Tab"><a href="#TabSummary" data-toggle="tab">参数</a></li>
    <li class="Tab dropdown">
        <a href="#notice1" data-toggle="modal" data-toggle="tab">
            说明书
        </a>
    </li>
</ul>

<div id="myTabContent" class="tab-content">
    <div class="tab-pane fade in active" id="TabCanvas" style="background:#2e2e2e">
        <div id='TrendCanvas' style="height:640px;"></div>
    </div>
    <div class="tab-pane fade" id="TabSummary">
        <dl  id = "Summary" style="background:#2e2e2e"></dl>
    </div>
    <div class="modal fade" id="notice1" tabindex="-1" role="dialog" 
       aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" 
                    data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                    货量说明
                    </h4>
                </div>
                <div class="modal-body">
                <dl>
                    <dt>取值逻辑</dt>
                    <dd>1 获取查询日期内所有录单单号和签收单号</dd>
                    <dd>2 根据单号确定体积重量和实际重量，并取最大值</dd>
                    <dd>3 对录单重量和签收重量求和</dd>
                    <dt>时间节点</dt>
                    <dd>- 查询起始日期8:00至查询结束日期次日8:00</dd>
                    <dt>注意事项</dt>
                    <dd>- 数据实时更新，查询当日或前一日数据由于部分数据不全会偏低</dd>
                </dl>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" 
                    data-dismiss="modal">     
                    我知道了
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>