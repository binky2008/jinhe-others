<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>班车考勤汇总</title>

    <link rel="stylesheet" type="text/css" href="../../tools/easyui/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../tools/easyui/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../dm/common.css">

    <script src="../../tools/easyui/jquery.min.js"></script>
    <script src="../../tools/easyui/jquery.easyui.min.js"></script>

    <script src="../../framework/core.js"></script>
    <script src="../../framework/ajax.js"></script>
    <script src="../../dm/common.js"></script>
    
    <script src="../../tools/echarts-2.0.4/echarts-plain.js"></script>

    <script type="text/javascript">
    var globalValiable = window.parent.globalValiable,
        sub;

    Array.prototype.contains = function(obj) {  
        var i = this.length;  
        while (i--) {  
            if (this[i] === obj) {  
                return true;  
            }  
        }  
        return false;  
    }  

    window.onload = function() {
        var canvas = document.getElementById('canvas');
        
        canvas.style.height = (screen.height * 0.9091 - 160) + 'px';

        if(globalValiable && globalValiable.data) {
            queryParams = globalValiable.queryParams;
            sub = queryParams.param1 + '至' + queryParams.param2;

            Painting();
            return;
        }
    } 

    function Painting(){
        var originData = globalValiable.data,
            daylist = [],
            data = [],
            data2 = [],
            n1 = 0,
            n2 = 0,
            tn1 = 0,
            tn2 = 0,
            minr = 100;

        for(var i = 0; i < originData.length; i++){
            var inday = originData[i]["inday"],
                type = originData[i]["type"],
                rate = originData[i]["r"],
                n = originData[i]["n"],
                tn = originData[i]["tn"];

            if(!daylist.contains(inday)){
                daylist.push(inday);
            }

            if(type == '交件到港'){
                data.push(rate);
                n1 += n;
                tn1 += tn;
            }
            else{
                data2.push(rate);
                n2 += n;
                tn2 += tn;
            }

            if(rate < minr){
                minr = rate;
            }
        }

        sub = sub + '  交件平均:' + Math.round(n1/tn1*1000)/10 +
        '  接件平均:' + Math.round(n2/tn2*1000)/10;

        minr = Math.floor(minr/10)*10;

        var myChart = echarts.init(document.getElementById('canvas'));
////////////////////////////////////Option
var option = {
    title : {
        text: '交接件时效走势',
        textStyle:{fontSize:'24',color:'#000',fontFamily:'Microsoft YaHei'},
        subtext:sub,
        subtextStyle:{fontSize:'18',color: '#999999',fontFamily:'Microsoft YaHei'},
        x:'center'
    },
    tooltip : {
        trigger: 'axis',
        textStyle:{fontSize:'16',color:'#fff',fontFamily:'Microsoft YaHei'},
    },
    legend: {
        data:['交件到港','取件离港'],
        x:'left',
        textStyle:{fontSize:'14',fontFamily:'Microsoft YaHei'}
    },
    calculable : true,
    xAxis : [
        {
            type : 'category',
            axisLine:{lineStyle:{color:'#999'}},
            boundaryGap : false,
            axisLabel:{
                rotate:-30,
                interval:0,
                textStyle:{color:'#999',fontSize:'16'}
            },
            data : daylist
        }
    ],
    yAxis : [
        {
            name:'百分比',
            nameTextStyle:{
                fontSize:'16',
                fontFamily:'Microsoft YaHei'
            },
            splitNumber:(100-minr)/5,
            type : 'value',
            axisLine:{lineStyle:{color:'#999'}},
            axisLabel:{textStyle:{color:'#999',fontSize:'16'}},
            min:minr,
            max:100
        }
    ],
    series : [
        {
            name:'交件到港',
            type:'line',
            data:data,
            symbol: 'star6',
            symbolSize : 16,
            symbolRotate : 10,
            itemStyle: {        // 数据级个性化折线样式
                normal: {
                    color: 'yellowgreen'
                },
                emphasis: {
                    color: '#FFD661',
                    label : {
                        show: true,
                        position: 'inside',
                        textStyle : {
                            color:'#000',
                            fontSize : '14'
                        }
                    }                
                }
            }           
        },
        {
            name:'取件离港',
            type:'line',
            data:data2,
            symbol: 'star6',
            symbolSize : 16,
            symbolRotate : 10,
            itemStyle: {        // 数据级个性化折线样式
                normal: {
                    color: '#00ABD8'
                },
                emphasis: {
                    color: '#FFD661',
                    label : {
                        show: true,
                        position: 'inside',
                        textStyle : {
                            color:'#000',
                            fontSize : '14'
                        }
                    }                
                }
            }           
        }
    ]
};            
        myChart.setOption(option);

    }

    </script>

    <style type="text/css">
        dt {font-family:Microsoft YaHei;font-size:20px;}
        dd {font-family:Microsoft YaHei;font-size:16px;text-indent:30px}
    </style>
</head>

<body>
	<div class="easyui-tabs" id='Tab' data-options='fit:true'>
        <div title="走势图" id='bar' style="font-family:Microsoft YaHei;font-size:16px;"> 
            <div id='canvas' style="height:640px;border:1px solid #ccc;padding:10px;"></div>
        </div>
        <div title="说明书" id='TabNotice'>
            <dl>
            <dt>取值逻辑</dt>
            <dd>- 根据当日站点发件扫描、分拨的发件扫描，对比班车考勤，查出交件漏扫、接件漏扫班车。打卡的班车则根据打卡时间、打卡类型，对比规定打卡时间，判断考勤是否延误、计算延误时间和理论处罚金额</dd>
            <dt>时间节点</dt>
            <dd>- 当日14:30至次日14:30</dd>
            <dd>- 按考勤时间计算</dd>
            <dt>注意点</dt>
            <dd>- 由于系统规定考勤时间不带日期格式，和打卡时间对比时会出现如下情况：规定时间是凌晨，打卡时间是前一日晚上，导致打卡时间大于规定时间。故做如下修正：规定时间在0:00到7:59间，打卡时间在18:00~23:59间，认为准时打卡；打卡时间在0:00点到7:59点间，规定时间在18:00~23:59间，认为延误。</dd>
            <dd>- 规定时间在18:00~23:59间，打卡时间在当日0:00点到7:59点间，在提早10个小时打卡的情况下，可能会误判为延误。但是此种情况罕见，几乎没有大的影响</dd>
            <dd>- 数据结果中不包含直客窗口、派送窗口以及各种项目等站点数据</dd>
            </dl>
        </div>
    </div>
</body>
</html>