<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>时效总览</title>

    <link rel="stylesheet" type="text/css" href="../../dm/common.css">
    <link href="../../tools/bootstrap/css/buttons.css" rel="stylesheet">
    <link href="../../tools/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="../../tools/bootstrap/datatable/jquery.dataTables.min.css" rel="stylesheet">

    <script src="../../tools/jquery/jquery-2.1.3.min.js"></script>
    <script src="../../tools/bootstrap/js/bootstrap.min.js"></script>
    <script src="../../tools/bootstrap/datatable/jquery.dataTables.min.js"></script>
    <script src="../../tools/jquery/ZeroClipboard.js"></script>
    <script src="../../tools/echarts-2.0.4/echarts-plain-map.js"></script>
    <script src="../zk/CityLocation.js"></script>

    <script src="../../framework/core.js"></script>
    <script src="../../framework/ajax.js"></script>
    <script src="../../dm/common.js"></script>

    <script type="text/javascript">
    var originData = window.parent.globalValiable.data,
        MapMode = true,MapType = 1;

    window.onload = function() {
        var List = document.getElementById("CenterList"),
            CenterList = [],
            MyMap = document.getElementById('Map');

        MyMap.style.height = (screen.height - 220) + 'px';

        for(var i = 0; i < originData.length; i++){
            var center = originData[i]["center_in"],
                company = originData[i]["org_in"];

            if(!CenterList.contains(center)){
                CenterList.push(center);
                List.options.add(new Option(center,center));
            }
        }

        Map(); 
    } 

    function Map(){
        var selected = document.getElementById('CenterList').value,
            datar = [],datapoint = [],cList = [],maxr = 0,color = [],
            geoCoord = CityLocation();

        for(var i = 0; i < originData.length; i++){
            var center,centerto,r = originData[i]["r"];

            if(MapMode){
                center = originData[i]["center_in"];
                centerto = originData[i]["center_out"];
            }      
            else{
                center = originData[i]["org_in"];
                centerto = originData[i]["org_out"];
            } 

            if(center == selected){
                if(!cList.contains(center)){
                    datapoint.push({name: center,value:center});
                    cList.push(center);
                }
                if(!cList.contains(centerto)){
                    datapoint.push({name: centerto,value:centerto});
                    cList.push(centerto);
                }
 
                datar.push([{name:center},{name: centerto,value: r}]);

                if(r > maxr){maxr = r;}
            }
        }

        if(maxr <= 100){
            maxr = 100;
            color = ['lime','yellow','orange', '#ff3333','#ff3333'];
        }
        else if((maxr <= 110)&&(maxr > 100)){
            color = ['lime','yellow','orange', '#ff3333','#ff3333'];
        }
        else if((maxr <= 130)&&(maxr > 110)){
            color = ['lime','lime','yellow','orange', '#ff3333','#ff3333','#ff3333'];
        }
        else{
            color = ['lime','lime','lime','yellow','orange', '#ff3333','#ff3333','#ff3333'];
        }
   
        var series = [{
            name: '全国',
            type: 'map',
            roam: true,
            hoverable: false,
            mapType: 'china',
            itemStyle:{
                normal:{
                    borderColor:'rgba(0,138,186,0.9)',
                    borderWidth:1,
                    areaStyle:{
                        color: '#262126'
                    }
                }
            },
            data:[],
            markLine : {
                smooth:true,
                symbol: ['none', 'circle'],  
                symbolSize : 1,
                itemStyle : {
                    normal: {
                        color:'#fff',
                        borderWidth:1,
                        borderColor:'rgba(30,144,255,0.5)'
                    }
                },
                data : [],
            },
            geoCoord: geoCoord
        }];
        series.push({
            name: 'LoadRateMap',
            type: 'map',
            mapType: 'china',
            data:[],
            markLine : {
                smooth:true,
                effect : {
                    show: true,
                    scaleSize: 1,
                    period: 30,
                    color: '#fff',
                    shadowBlur: 10
                },
                itemStyle : {
                    normal: {
                        borderWidth:1,
                        lineStyle: {
                            type: 'solid',
                            shadowBlur: 10
                        }
                    }
                },
                data : datar
            },
            markPoint : {
                symbol:'emptyCircle',
                symbolSize :3,
                effect : {
                    show:true,
                    shadowBlur : 0
                },
                itemStyle:{
                    normal:{
                        color:'#fff8dc',
                        label:{
                            show:true
                        }
                    },
                    emphasis:{
                        color:'#FFFA40',
                        label:{
                            show:false
                        }
                    }
                },
                data : datapoint
            }
        });

        var myChart = echarts.init(document.getElementById('Map'));

var option = {
    backgroundColor: '#262126',
    dataRange: {
        show:false,
        min : 0,
        max : maxr,
        calculable : true,
        color: color,
        textStyle:{color:'#fff',fontFamily:'Microsoft YaHei'}
    },
    tooltip : {
        textStyle:{color:'#E8C446',fontSize:'18',fontFamily:'Microsoft YaHei'},
        trigger: 'item',
        formatter: function (v) {
            if((v[0] == 'LoadRateMap')&&(v[1].indexOf('>') >= 0)){
                return v[1].replace(' > ',':') + ' ' + v[3] + '%';
            }
            else{
                return v[1];
            }
        }
    },
    series : series
};         
        myChart.setOption(option);
    }

    Array.prototype.contains = function(obj) {  
        var i = this.length;  
        while (i--) {  
            if (this[i] === obj) {  
                return true;  
            }  
        }  
        return false;  
    }  
    </script>

    <style type="text/css">
        img {max-height: 100%;}
        dt {font-family:Microsoft YaHei;font-size:20px;}
        dd {font-family:Microsoft YaHei;font-size:16px;text-indent:30px}
        li {font-family:Microsoft YaHei;}
        th {
            color:#999;
            font-family:Microsoft YaHei;
            font-style:normal;
        }
        td{font-family:Microsoft YaHei;}
        span {width:16px;height:16px;}
        .modal-title{font-family:Microsoft YaHei;color:#337AB7;}
        .panel-heading {font-family:Microsoft YaHei;}
        .table-hover{margin-top: 15px;}
        .btn {font-family:Microsoft YaHei;}
        .copybtn {
            font-family:Microsoft YaHei;
            width:140px;
            margin-top: 3px;
        }
        .Tab {font-family:Microsoft YaHei;}
        .navcustom{
            font-family:Microsoft YaHei;
            text-align: center;
            color:#337AB7;
            width: 140px;
            margin-top: 5px;
            margin-left: 15px;
            border-radius: 4px;
            border: 1px solid #ddd;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.067);
        }
        #CenterList {
            font-family:Microsoft YaHei;
            font-size:16px;
            float:right;
            padding:3px;
            color:#fff8dc;
            display:inline-block;
            border-color:#999;
            background-color:#262126;
            text-align:right;
            margin-top: 1px;
        }
        #CenterList option:hover { 
            background-color: #f80; 
            color: #fff; 
        }
/*//////////////////////////////////////Bootstrap Style*/
        .navcustom li{
            margin: 0;
            border-top: 1px solid #ddd;
        }
        .navcustom li:first-child{
            border-top: none;
        }
        .navcustom li a{
            margin: 0;
            padding: 8px 16px;
            border-radius: 0;
        }
        .navcustom li.active a, ul.nav-tabs li.active a:hover{
            color: #fff;
            background: #0088cc;
            border: 1px solid #0088cc;
        }
        .navcustom li:first-child a{
            border-radius: 4px 4px 0 0;
        }
        .navcustom li:last-child a{
            border-radius: 0 0 4px 4px;
        }
        .navcustom.affix{
            top: 30px; /* Set the top position of pinned element */
        }
    </style>
</head>

<body style="background-color:#262126">
    <select id="CenterList" onchange="Map()"></select>
    <div id="Map" style="height:640px;"></div>
</body>
</html>